# Copilot Instructions for ioBroker Developer Portal

## Project Overview

This repository contains the **ioBroker Developer Portal** (https://www.iobroker.dev), a comprehensive web application that provides tools and resources for ioBroker adapter developers. ioBroker is a home automation platform, and this portal helps developers create, manage, and publish adapters (plugins) for the platform.

## Key Features

- **Adapter Creator Tool**: Wizard-based tool for generating new ioBroker adapter projects
- **Adapter Management**: Tools for managing existing adapters, releases, and translations
- **Developer Resources**: Documentation, best practices, and community links
- **GitHub Integration**: OAuth-based authentication and repository management
- **Weblate Integration**: Translation management for adapters
- **Statistics and Analytics**: Adapter usage and development insights

## Technology Stack

### Frontend
- **React 18** with TypeScript
- **Material-UI (MUI) v6** for components and theming
- **React Router** for client-side routing
- **Axios** for API communication
- **React Context** for state management
- **ECharts** for data visualization
- **WebSocket** for real-time communication

### Backend
- **Node.js** with **Express.js**
- **TypeScript** for type safety
- **MongoDB** for data storage
- **WebSocket (ws)** for real-time features
- **GitHub API** integration via Octokit
- **Cron jobs** for scheduled tasks
- **Docker** for containerization

### Development Environment
- **DevContainers** with VS Code integration
- **Docker Compose** for orchestration
- **Hot reload** for both frontend and backend
- **Prettier** and **ESLint** for code formatting
- **GitHub Copilot** integration

## Repository Structure

```
├── .devcontainer/          # DevContainer configuration
├── .github/               # GitHub workflows and configurations
├── express/               # Main application directory
│   ├── backend/          # Express.js backend
│   │   ├── src/          # TypeScript source code
│   │   │   ├── api/      # API route handlers
│   │   │   ├── apps/     # Application-specific logic
│   │   │   ├── auth.ts   # Authentication handling
│   │   │   └── index.ts  # Main server entry point
│   │   └── package.json  # Backend dependencies
│   └── frontend/         # React frontend
│       ├── src/          # React TypeScript source
│       │   ├── components/ # Reusable UI components
│       │   ├── contexts/   # React Context providers
│       │   ├── tools/      # Feature-specific tools
│       │   └── App.tsx     # Main React component
│       └── package.json    # Frontend dependencies
├── docker-compose.yml     # Development orchestration
└── README.md             # Project documentation
```

## Code Style and Conventions

### Formatting (Prettier Configuration)
- **Use tabs** for indentation (tabWidth: 4)
- **80 character** line width
- **Semicolons required**
- **Double quotes** for strings
- **Trailing commas** in all multi-line structures
- **LF line endings**

### TypeScript Conventions
- **Strict mode** enabled for both frontend and backend
- **Explicit typing** preferred over `any`
- **Interface definitions** for all object shapes
- **Functional components** with hooks in React
- **Context providers** for shared state

### File Naming
- **PascalCase** for React components (`UserContext.tsx`)
- **camelCase** for utility files (`auth.ts`)
- **kebab-case** for directories when appropriate
- **Descriptive names** that indicate purpose

### Component Patterns
- Use **function declarations** for React components
- **Export at declaration** for main components
- **Props interfaces** defined above components
- **Context providers** for cross-component state
- **Custom hooks** for reusable logic

## Development Setup

### Requirements
- **VS Code** with DevContainer support
- **Docker** and **Docker Compose**
- **Git** for version control

### Getting Started
1. Clone the repository
2. Open in VS Code
3. Reopen in DevContainer when prompted
4. Frontend and backend will start automatically
5. Access the application at `http://localhost:8080`

### Environment Variables
The application requires several environment variables for full functionality:

**Required:**
- `PORTAL_GITHUB_OAUTH_CLIENT_ID` - GitHub OAuth for portal
- `PORTAL_GITHUB_OAUTH_CLIENT_SECRET` - GitHub OAuth secret
- `CREATOR_GITHUB_OAUTH_CLIENT_ID` - GitHub OAuth for adapter creator
- `CREATOR_GITHUB_OAUTH_CLIENT_SECRET` - GitHub OAuth secret

**Optional:**
- `WEBLATE_ACCESS_TOKEN` - For translation management
- `SENTRY_AUTH_TOKEN` - For error tracking
- `ALLOW_CORS` - Enable CORS for development

## Key Concepts and Domain Knowledge

### ioBroker Ecosystem
- **Adapters** are plugins that extend ioBroker functionality
- **Instances** are running copies of adapters
- **Objects** represent devices, states, and configuration
- **States** hold current values and can be read/written
- **Repository** system for adapter distribution

### Adapter Development Workflow
1. **Create** adapter using the Creator Tool
2. **Develop** using ioBroker patterns and APIs
3. **Test** locally and with automated tools
4. **Translate** using Weblate integration
5. **Release** and publish to npm
6. **Submit** to ioBroker repository for review

### Common Patterns
- **GitHub OAuth** authentication for repository access
- **WebSocket** communication for real-time updates
- **Token management** for GitHub and npm access
- **ZIP generation** for adapter scaffolding
- **MongoDB** document storage patterns

## API Patterns

### Backend Routes
- `/api/user/*` - User authentication and management
- `/api/adapter/*` - Adapter-related operations
- `/api/weblate/*` - Translation proxy
- `/api/npm/*` - npm registry proxy
- `/apps/create-adapter` - Adapter creation tool

### Frontend Structure
- **Context providers** for global state
- **Tool-specific** route handling
- **Material-UI** component composition
- **Axios** with interceptors for API calls

## Testing and Quality

### Frontend Testing
- **React Testing Library** for component tests
- **Jest** as test runner
- Run with: `npm test` in frontend directory

### Code Quality
- **TypeScript** strict mode for type safety
- **ESLint** for code quality (React app configuration)
- **Prettier** for consistent formatting
- **GitHub Actions** for CI/CD

## Deployment

### Development
- Uses **DevContainers** with automatic startup
- **Hot reload** for both frontend and backend
- **Proxy** routes frontend requests to backend

### Production
- **Docker Compose** orchestration
- **GitHub Container Registry** for images
- **Environment-based** configuration
- **Watchtower** for automatic updates

## Important Notes for AI Assistance

1. **Preserve ioBroker context** - This is domain-specific software for home automation
2. **GitHub integration is critical** - Many features depend on GitHub API access
3. **Material-UI patterns** - Use MUI components and theming consistently
4. **TypeScript strict mode** - Always provide proper type definitions
5. **DevContainer workflow** - Development should work seamlessly in containers
6. **Adapter creation focus** - Core functionality is helping developers build adapters
7. **Translation support** - Consider internationalization in new features
8. **Real-time features** - WebSocket connections are used for live updates

## When Making Changes

- **Test in DevContainer** environment to ensure consistency
- **Follow TypeScript** strict typing requirements
- **Use Material-UI** components for UI consistency
- **Consider mobile** responsiveness for all UI changes
- **Maintain GitHub** OAuth integration patterns
- **Update documentation** when adding new features
- **Consider translation** needs for user-facing text
- **Test adapter creation** workflow if modifying related code

## Helpful Commands

```bash
# Start development environment
docker-compose up

# Frontend commands (in express/frontend/)
npm start          # Start development server
npm run build      # Build for production
npm test           # Run tests

# Backend commands (in express/backend/)
npm run watch      # Start with hot reload
npm run build      # Compile TypeScript
npm run watch:debug # Start with debugger

# Docker commands
docker-compose pull && docker-compose up  # Update and start
docker login docker.pkg.github.com        # Login to GitHub registry
```

This portal is a critical tool for the ioBroker community, helping developers create high-quality adapters that extend the platform's capabilities for home automation enthusiasts worldwide.